/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// main.ts
__export(exports, {
  default: () => ImageAddPlugin
});
var import_obsidian = __toModule(require("obsidian"));
var DEFAULT_SETTINGS = {
  defaultSize: 200,
  defaultAlignment: "center"
};
var ASSETS_FOLDER = "99 - \u041E\u0431\u0449\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044B/99 - \u041E\u0441\u0442\u0430\u043B\u044C\u043D\u043E\u0435/\u0410\u0441\u0441\u0435\u0442\u044B";
var ImageAddPlugin = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("image", "Image Add", () => {
      new ImageAddModal(this.app, this).open();
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var ImageAddModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
    this.selectedImage = "";
    this.selectedSize = 200;
    this.selectedAlignment = "center";
    this.selectedFile = null;
    this.allowedExt = "";
    this.fileNameInput = null;
    this.extSpan = null;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("image-add-modal");
    contentEl.createEl("h2", { text: "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435" });
    const selectButton = contentEl.createEl("button", {
      text: "\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435",
      cls: "mod-cta"
    });
    selectButton.addEventListener("click", async () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".jpg,.jpeg,.png";
      input.onchange = async (e) => {
        var _a, _b;
        const file = (_a = e.target.files) == null ? void 0 : _a[0];
        if (!file)
          return;
        const ext = (_b = file.name.split(".").pop()) == null ? void 0 : _b.toLowerCase();
        if (ext !== "jpg" && ext !== "jpeg" && ext !== "png") {
          new import_obsidian.Notice("\u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u044B \u0442\u043E\u043B\u044C\u043A\u043E \u0444\u0430\u0439\u043B\u044B .jpg \u0438 .png");
          this.selectedFile = null;
          this.allowedExt = "";
          this.updateFileNameInput();
          return;
        }
        this.selectedFile = file;
        this.allowedExt = ext === "jpeg" ? "jpg" : ext;
        this.selectedImage = file.name.substring(0, file.name.lastIndexOf("."));
        this.updateFileNameInput();
      };
      input.click();
    });
    const fileNameContainer = contentEl.createEl("div", { cls: "setting-item" });
    fileNameContainer.createEl("label", { text: "\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430: " });
    this.fileNameInput = fileNameContainer.createEl("input", {
      type: "text",
      value: this.selectedImage
    });
    this.extSpan = fileNameContainer.createEl("span", { text: "", cls: "file-ext-span" });
    this.fileNameInput.addEventListener("input", () => {
      this.selectedImage = this.fileNameInput.value;
    });
    const sizeContainer = contentEl.createEl("div", { cls: "setting-item" });
    sizeContainer.createEl("label", { text: "\u0420\u0430\u0437\u043C\u0435\u0440: " });
    const sizeSelect = sizeContainer.createEl("select");
    [100, 150, 200, 250, 300].forEach((size) => {
      const option = sizeSelect.createEl("option", {
        text: size.toString(),
        value: size.toString()
      });
      if (size === this.selectedSize) {
        option.selected = true;
      }
    });
    sizeSelect.addEventListener("change", (e) => {
      this.selectedSize = parseInt(e.target.value);
    });
    const alignmentContainer = contentEl.createEl("div", { cls: "setting-item" });
    alignmentContainer.createEl("label", { text: "\u0412\u044B\u0440\u0430\u0432\u043D\u0438\u0432\u0430\u043D\u0438\u0435: " });
    const alignmentSelect = alignmentContainer.createEl("select");
    ["left", "center", "right"].forEach((alignment) => {
      const option = alignmentSelect.createEl("option", {
        text: alignment,
        value: alignment
      });
      if (alignment === this.selectedAlignment) {
        option.selected = true;
      }
    });
    alignmentSelect.addEventListener("change", (e) => {
      this.selectedAlignment = e.target.value;
    });
    const addButton = contentEl.createEl("button", {
      text: "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",
      cls: "mod-cta"
    });
    addButton.addEventListener("click", () => this.saveImage());
    this.updateFileNameInput();
  }
  updateFileNameInput() {
    if (this.fileNameInput) {
      this.fileNameInput.value = this.selectedImage || "";
      this.fileNameInput.disabled = !this.selectedFile;
    }
    if (this.extSpan) {
      this.extSpan.setText(this.allowedExt ? "." + this.allowedExt : "");
    }
  }
  async saveImage() {
    if (!this.selectedFile || !this.selectedImage || !this.allowedExt)
      return;
    const newFileName = this.selectedImage.replace(/[\\/:*?"<>|]/g, "") + "." + this.allowedExt;
    const filePath = `${ASSETS_FOLDER}/${newFileName}`;
    const folder = this.app.vault.getAbstractFileByPath(ASSETS_FOLDER);
    if (!folder) {
      await this.app.vault.createFolder(ASSETS_FOLDER);
    }
    const reader = new FileReader();
    reader.onload = async (event) => {
      var _a;
      if (!((_a = event.target) == null ? void 0 : _a.result))
        return;
      const arrayBuffer = event.target.result;
      try {
        await this.app.vault.createBinary(filePath, arrayBuffer);
        this.selectedFile = null;
        this.selectedImage = "";
        this.allowedExt = "";
        this.updateFileNameInput();
        new import_obsidian.Notice("\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E");
        const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
        if (activeView) {
          const editor = activeView.editor;
          const cursor = editor.getCursor();
          const imageText = `![[${newFileName}|${this.selectedAlignment}|${this.selectedSize}]]`;
          editor.replaceRange(imageText, cursor);
        }
        this.close();
      } catch (error) {
        new import_obsidian.Notice("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");
        console.error(error);
      }
    };
    reader.readAsArrayBuffer(this.selectedFile);
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTW9kYWwsIE5vdGljZSwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcclxuXHJcbmludGVyZmFjZSBJbWFnZUFkZFNldHRpbmdzIHtcclxuICAgIGRlZmF1bHRTaXplOiBudW1iZXI7XHJcbiAgICBkZWZhdWx0QWxpZ25tZW50OiBzdHJpbmc7XHJcbn1cclxuXHJcbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEltYWdlQWRkU2V0dGluZ3MgPSB7XHJcbiAgICBkZWZhdWx0U2l6ZTogMjAwLFxyXG4gICAgZGVmYXVsdEFsaWdubWVudDogJ2NlbnRlcidcclxufVxyXG5cclxuY29uc3QgQVNTRVRTX0ZPTERFUiA9IFwiOTkgLSBcdTA0MUVcdTA0MzFcdTA0NDlcdTA0MzhcdTA0MzUgXHUwNDQwXHUwNDM1XHUwNDQxXHUwNDQzXHUwNDQwXHUwNDQxXHUwNDRCLzk5IC0gXHUwNDFFXHUwNDQxXHUwNDQyXHUwNDMwXHUwNDNCXHUwNDRDXHUwNDNEXHUwNDNFXHUwNDM1L1x1MDQxMFx1MDQ0MVx1MDQ0MVx1MDQzNVx1MDQ0Mlx1MDQ0QlwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW1hZ2VBZGRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gICAgc2V0dGluZ3M6IEltYWdlQWRkU2V0dGluZ3M7XHJcblxyXG4gICAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIC8vIFx1MDQxNFx1MDQzRVx1MDQzMVx1MDQzMFx1MDQzMlx1MDQzQlx1MDQ0Rlx1MDQzNVx1MDQzQyBcdTA0MzhcdTA0M0FcdTA0M0VcdTA0M0RcdTA0M0FcdTA0NDMgXHUwNDMyIFx1MDQzMVx1MDQzRVx1MDQzQVx1MDQzRVx1MDQzMlx1MDQ0M1x1MDQ0RSBcdTA0M0ZcdTA0MzBcdTA0M0RcdTA0MzVcdTA0M0JcdTA0NENcclxuICAgICAgICB0aGlzLmFkZFJpYmJvbkljb24oJ2ltYWdlJywgJ0ltYWdlIEFkZCcsICgpID0+IHtcclxuICAgICAgICAgICAgbmV3IEltYWdlQWRkTW9kYWwodGhpcy5hcHAsIHRoaXMpLm9wZW4oKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIEltYWdlQWRkTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwcml2YXRlIHNlbGVjdGVkSW1hZ2U6IHN0cmluZyA9ICcnO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZFNpemU6IG51bWJlciA9IDIwMDtcclxuICAgIHByaXZhdGUgc2VsZWN0ZWRBbGlnbm1lbnQ6IHN0cmluZyA9ICdjZW50ZXInO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZEZpbGU6IEZpbGUgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgYWxsb3dlZEV4dDogc3RyaW5nID0gJyc7XHJcbiAgICBwcml2YXRlIGZpbGVOYW1lSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgZXh0U3BhbjogSFRNTFNwYW5FbGVtZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHByaXZhdGUgcGx1Z2luOiBJbWFnZUFkZFBsdWdpbikge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgICAgICBjb250ZW50RWwuYWRkQ2xhc3MoJ2ltYWdlLWFkZC1tb2RhbCcpO1xyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7dGV4dDogJ1x1MDQxNFx1MDQzRVx1MDQzMVx1MDQzMFx1MDQzMlx1MDQzOFx1MDQ0Mlx1MDQ0QyBcdTA0MzhcdTA0MzdcdTA0M0VcdTA0MzFcdTA0NDBcdTA0MzBcdTA0MzZcdTA0MzVcdTA0M0RcdTA0MzhcdTA0MzUnfSk7XHJcblxyXG4gICAgICAgIC8vIFx1MDQxQVx1MDQzRFx1MDQzRVx1MDQzRlx1MDQzQVx1MDQzMCBcdTA0MzJcdTA0NEJcdTA0MzFcdTA0M0VcdTA0NDBcdTA0MzAgXHUwNDM4XHUwNDM3XHUwNDNFXHUwNDMxXHUwNDQwXHUwNDMwXHUwNDM2XHUwNDM1XHUwNDNEXHUwNDM4XHUwNDRGXHJcbiAgICAgICAgY29uc3Qgc2VsZWN0QnV0dG9uID0gY29udGVudEVsLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgICAgICAgIHRleHQ6ICdcdTA0MTJcdTA0NEJcdTA0MzFcdTA0NDBcdTA0MzBcdTA0NDJcdTA0NEMgXHUwNDM4XHUwNDM3XHUwNDNFXHUwNDMxXHUwNDQwXHUwNDMwXHUwNDM2XHUwNDM1XHUwNDNEXHUwNDM4XHUwNDM1JyxcclxuICAgICAgICAgICAgY2xzOiAnbW9kLWN0YSdcclxuICAgICAgICB9KTtcclxuICAgICAgICBzZWxlY3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgaW5wdXQudHlwZSA9ICdmaWxlJztcclxuICAgICAgICAgICAgaW5wdXQuYWNjZXB0ID0gJy5qcGcsLmpwZWcsLnBuZyc7XHJcbiAgICAgICAgICAgIGlucHV0Lm9uY2hhbmdlID0gYXN5bmMgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSAoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkuZmlsZXM/LlswXTtcclxuICAgICAgICAgICAgICAgIGlmICghZmlsZSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXh0ID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk/LnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXh0ICE9PSAnanBnJyAmJiBleHQgIT09ICdqcGVnJyAmJiBleHQgIT09ICdwbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnXHUwNDIwXHUwNDMwXHUwNDM3XHUwNDQwXHUwNDM1XHUwNDQ4XHUwNDM1XHUwNDNEXHUwNDRCIFx1MDQ0Mlx1MDQzRVx1MDQzQlx1MDQ0Q1x1MDQzQVx1MDQzRSBcdTA0NDRcdTA0MzBcdTA0MzlcdTA0M0JcdTA0NEIgLmpwZyBcdTA0MzggLnBuZycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFsbG93ZWRFeHQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZpbGVOYW1lSW5wdXQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IGZpbGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93ZWRFeHQgPSBleHQgPT09ICdqcGVnJyA/ICdqcGcnIDogZXh0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEltYWdlID0gZmlsZS5uYW1lLnN1YnN0cmluZygwLCBmaWxlLm5hbWUubGFzdEluZGV4T2YoJy4nKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZpbGVOYW1lSW5wdXQoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaW5wdXQuY2xpY2soKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHUwNDE4XHUwNDNDXHUwNDRGIFx1MDQ0NFx1MDQzMFx1MDQzOVx1MDQzQlx1MDQzMCAoXHUwNDQyXHUwNDNFXHUwNDNCXHUwNDRDXHUwNDNBXHUwNDNFIFx1MDQzOFx1MDQzQ1x1MDQ0RiwgXHUwNDQwXHUwNDMwXHUwNDQxXHUwNDQ4XHUwNDM4XHUwNDQwXHUwNDM1XHUwNDNEXHUwNDM4XHUwNDM1IFx1MDQzRVx1MDQ0Mlx1MDQzNFx1MDQzNVx1MDQzQlx1MDQ0Q1x1MDQzRFx1MDQzRSlcclxuICAgICAgICBjb25zdCBmaWxlTmFtZUNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge2NsczogJ3NldHRpbmctaXRlbSd9KTtcclxuICAgICAgICBmaWxlTmFtZUNvbnRhaW5lci5jcmVhdGVFbCgnbGFiZWwnLCB7dGV4dDogJ1x1MDQxOFx1MDQzQ1x1MDQ0RiBcdTA0NDRcdTA0MzBcdTA0MzlcdTA0M0JcdTA0MzA6ICd9KTtcclxuICAgICAgICB0aGlzLmZpbGVOYW1lSW5wdXQgPSBmaWxlTmFtZUNvbnRhaW5lci5jcmVhdGVFbCgnaW5wdXQnLCB7XHJcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuc2VsZWN0ZWRJbWFnZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZXh0U3BhbiA9IGZpbGVOYW1lQ29udGFpbmVyLmNyZWF0ZUVsKCdzcGFuJywge3RleHQ6ICcnLCBjbHM6ICdmaWxlLWV4dC1zcGFuJ30pO1xyXG4gICAgICAgIHRoaXMuZmlsZU5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEltYWdlID0gdGhpcy5maWxlTmFtZUlucHV0IS52YWx1ZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHUwNDIwXHUwNDMwXHUwNDM3XHUwNDNDXHUwNDM1XHUwNDQwXHJcbiAgICAgICAgY29uc3Qgc2l6ZUNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge2NsczogJ3NldHRpbmctaXRlbSd9KTtcclxuICAgICAgICBzaXplQ29udGFpbmVyLmNyZWF0ZUVsKCdsYWJlbCcsIHt0ZXh0OiAnXHUwNDIwXHUwNDMwXHUwNDM3XHUwNDNDXHUwNDM1XHUwNDQwOiAnfSk7XHJcbiAgICAgICAgY29uc3Qgc2l6ZVNlbGVjdCA9IHNpemVDb250YWluZXIuY3JlYXRlRWwoJ3NlbGVjdCcpO1xyXG4gICAgICAgIFsxMDAsIDE1MCwgMjAwLCAyNTAsIDMwMF0uZm9yRWFjaChzaXplID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gc2l6ZVNlbGVjdC5jcmVhdGVFbCgnb3B0aW9uJywge1xyXG4gICAgICAgICAgICAgICAgdGV4dDogc2l6ZS50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHNpemUudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHNpemUgPT09IHRoaXMuc2VsZWN0ZWRTaXplKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2l6ZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkU2l6ZSA9IHBhcnNlSW50KChlLnRhcmdldCBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBcdTA0MTJcdTA0NEJcdTA0NDBcdTA0MzBcdTA0MzJcdTA0M0RcdTA0MzhcdTA0MzJcdTA0MzBcdTA0M0RcdTA0MzhcdTA0MzVcclxuICAgICAgICBjb25zdCBhbGlnbm1lbnRDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRWwoJ2RpdicsIHtjbHM6ICdzZXR0aW5nLWl0ZW0nfSk7XHJcbiAgICAgICAgYWxpZ25tZW50Q29udGFpbmVyLmNyZWF0ZUVsKCdsYWJlbCcsIHt0ZXh0OiAnXHUwNDEyXHUwNDRCXHUwNDQwXHUwNDMwXHUwNDMyXHUwNDNEXHUwNDM4XHUwNDMyXHUwNDMwXHUwNDNEXHUwNDM4XHUwNDM1OiAnfSk7XHJcbiAgICAgICAgY29uc3QgYWxpZ25tZW50U2VsZWN0ID0gYWxpZ25tZW50Q29udGFpbmVyLmNyZWF0ZUVsKCdzZWxlY3QnKTtcclxuICAgICAgICBbJ2xlZnQnLCAnY2VudGVyJywgJ3JpZ2h0J10uZm9yRWFjaChhbGlnbm1lbnQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb24gPSBhbGlnbm1lbnRTZWxlY3QuY3JlYXRlRWwoJ29wdGlvbicsIHtcclxuICAgICAgICAgICAgICAgIHRleHQ6IGFsaWdubWVudCxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBhbGlnbm1lbnRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChhbGlnbm1lbnQgPT09IHRoaXMuc2VsZWN0ZWRBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBhbGlnbm1lbnRTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEFsaWdubWVudCA9IChlLnRhcmdldCBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFx1MDQxQVx1MDQzRFx1MDQzRVx1MDQzRlx1MDQzQVx1MDQzMCBcdTA0MzRcdTA0M0VcdTA0MzFcdTA0MzBcdTA0MzJcdTA0M0JcdTA0MzVcdTA0M0RcdTA0MzhcdTA0NEZcclxuICAgICAgICBjb25zdCBhZGRCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHtcclxuICAgICAgICAgICAgdGV4dDogJ1x1MDQxNFx1MDQzRVx1MDQzMVx1MDQzMFx1MDQzMlx1MDQzOFx1MDQ0Mlx1MDQ0QycsXHJcbiAgICAgICAgICAgIGNsczogJ21vZC1jdGEnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zYXZlSW1hZ2UoKSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVGaWxlTmFtZUlucHV0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlRmlsZU5hbWVJbnB1dCgpIHtcclxuICAgICAgICBpZiAodGhpcy5maWxlTmFtZUlucHV0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHRoaXMuc2VsZWN0ZWRJbWFnZSB8fCAnJztcclxuICAgICAgICAgICAgdGhpcy5maWxlTmFtZUlucHV0LmRpc2FibGVkID0gIXRoaXMuc2VsZWN0ZWRGaWxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5leHRTcGFuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0U3Bhbi5zZXRUZXh0KHRoaXMuYWxsb3dlZEV4dCA/ICcuJyArIHRoaXMuYWxsb3dlZEV4dCA6ICcnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc2F2ZUltYWdlKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbGUgfHwgIXRoaXMuc2VsZWN0ZWRJbWFnZSB8fCAhdGhpcy5hbGxvd2VkRXh0KSByZXR1cm47XHJcbiAgICAgICAgY29uc3QgbmV3RmlsZU5hbWUgPSB0aGlzLnNlbGVjdGVkSW1hZ2UucmVwbGFjZSgvW1xcXFwvOio/XCI8PnxdL2csICcnKSArICcuJyArIHRoaXMuYWxsb3dlZEV4dDtcclxuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke0FTU0VUU19GT0xERVJ9LyR7bmV3RmlsZU5hbWV9YDtcclxuICAgICAgICAvLyBcdTA0MUZcdTA0NDBcdTA0M0VcdTA0MzJcdTA0MzVcdTA0NDBcdTA0NEZcdTA0MzVcdTA0M0MgXHUwNDQxXHUwNDQzXHUwNDQ5XHUwNDM1XHUwNDQxXHUwNDQyXHUwNDMyXHUwNDNFXHUwNDMyXHUwNDMwXHUwNDNEXHUwNDM4XHUwNDM1IFx1MDQzRlx1MDQzMFx1MDQzRlx1MDQzQVx1MDQzOFxyXG4gICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChBU1NFVFNfRk9MREVSKTtcclxuICAgICAgICBpZiAoIWZvbGRlcikge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIoQVNTRVRTX0ZPTERFUik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFx1MDQyN1x1MDQzOFx1MDQ0Mlx1MDQzMFx1MDQzNVx1MDQzQyBcdTA0NDRcdTA0MzBcdTA0MzlcdTA0M0IgXHUwNDNBXHUwNDMwXHUwNDNBIEFycmF5QnVmZmVyXHJcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZXZlbnQudGFyZ2V0Py5yZXN1bHQpIHJldHVybjtcclxuICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBldmVudC50YXJnZXQucmVzdWx0IGFzIEFycmF5QnVmZmVyO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlQmluYXJ5KGZpbGVQYXRoLCBhcnJheUJ1ZmZlcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW1hZ2UgPSAnJztcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dlZEV4dCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGaWxlTmFtZUlucHV0KCk7XHJcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdcdTA0MThcdTA0MzdcdTA0M0VcdTA0MzFcdTA0NDBcdTA0MzBcdTA0MzZcdTA0MzVcdTA0M0RcdTA0MzhcdTA0MzUgXHUwNDQzXHUwNDQxXHUwNDNGXHUwNDM1XHUwNDQ4XHUwNDNEXHUwNDNFIFx1MDQzNFx1MDQzRVx1MDQzMVx1MDQzMFx1MDQzMlx1MDQzQlx1MDQzNVx1MDQzRFx1MDQzRScpO1xyXG4gICAgICAgICAgICAgICAgLy8gXHUwNDEyXHUwNDQxXHUwNDQyXHUwNDMwXHUwNDMyXHUwNDNCXHUwNDRGXHUwNDM1XHUwNDNDIFx1MDQ0MVx1MDQ0MVx1MDQ0Qlx1MDQzQlx1MDQzQVx1MDQ0MyBcdTA0MzIgXHUwNDM3XHUwNDMwXHUwNDNDXHUwNDM1XHUwNDQyXHUwNDNBXHUwNDQzXHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWRpdG9yID0gYWN0aXZlVmlldy5lZGl0b3I7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlVGV4dCA9IGAhW1ske25ld0ZpbGVOYW1lfXwke3RoaXMuc2VsZWN0ZWRBbGlnbm1lbnR9fCR7dGhpcy5zZWxlY3RlZFNpemV9XV1gO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoaW1hZ2VUZXh0LCBjdXJzb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnXHUwNDFFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIFx1MDQzRlx1MDQ0MFx1MDQzOCBcdTA0NDFcdTA0M0VcdTA0NDVcdTA0NDBcdTA0MzBcdTA0M0RcdTA0MzVcdTA0M0RcdTA0MzhcdTA0MzggXHUwNDM4XHUwNDM3XHUwNDNFXHUwNDMxXHUwNDQwXHUwNDMwXHUwNDM2XHUwNDM1XHUwNDNEXHUwNDM4XHUwNDRGJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHRoaXMuc2VsZWN0ZWRGaWxlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsb3NlKCkge1xyXG4gICAgICAgIGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxufSAiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBbUc7QUFPbkcsSUFBTSxtQkFBcUM7QUFBQSxFQUN2QyxhQUFhO0FBQUEsRUFDYixrQkFBa0I7QUFBQTtBQUd0QixJQUFNLGdCQUFnQjtBQUV0QixtQ0FBNEMsdUJBQU87QUFBQSxRQUd6QyxTQUFTO0FBQ1gsVUFBTSxLQUFLO0FBR1gsU0FBSyxjQUFjLFNBQVMsYUFBYSxNQUFNO0FBQzNDLFVBQUksY0FBYyxLQUFLLEtBQUssTUFBTTtBQUFBO0FBQUE7QUFBQSxRQUlwQyxlQUFlO0FBQ2pCLFNBQUssV0FBVyxPQUFPLE9B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
